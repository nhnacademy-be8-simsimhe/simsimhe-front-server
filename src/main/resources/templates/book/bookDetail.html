<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="${book.title} + ' - 상세정보'">Book Details</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5">
    <!-- 도서 제목 -->
    <header class="text-center mb-4">
        <h2 class="fw-bold fs-4" th:text="${book.title}">도서 제목</h2>
    </header>

    <div class="row">
        <!-- 이미지 섹션 -->
        <div class="col-md-4 text-center">
            <img th:src="${book.thumbnailImage}" class="img-fluid mb-3 rounded" alt="Thumbnail Image"
                 style="max-width: 100%; border: 1px solid #ccc; padding: 10px;">
            <img th:src="${book.detailImage}" class="img-fluid rounded" alt="Detail Image"
                 style="max-width: 100%; border: 1px solid #ccc; padding: 10px;">
        </div>

        <!-- 도서 상세 정보 -->
        <div class="col-md-8">
            <h4 class="fs-5">도서 정보</h4>
            <p><strong>출판사:</strong> <span th:text="${book.publisher}">출판사 이름</span></p>
            <p><strong>ISBN:</strong> <span th:text="${book.isbn}">ISBN 정보</span></p>
            <p><strong>페이지 수:</strong> <span th:text="${book.pages}">페이지 수</span></p>
            <p><strong>목차:</strong> <span th:text="${book.bookIndex}">목차</span></p>
            <p><strong>설명:</strong> <span th:text="${book.description}">도서 설명</span></p>

            <p><strong>가격:</strong>
                <span th:if="${book.saleprice != null}">
                    <s class="text-secondary small" th:text="${book.price}"></s>
                    <span class="fw-bold text-danger" th:text="${book.saleprice}"></span> 원
                </span>
                <span th:if="${book.saleprice == null}" class="fw-bold small" th:text="${book.price}">가격</span>
            </p>

            <!-- 좋아요 버튼 -->
            <div class="mt-3">
                <button type="button" class="btn btn-light like-button btn-sm" th:data-book-id="${book.bookId}"
                        th:data-is-liked="${book.isLiked}">
                    <i class="fa" th:classappend="${book.isLiked} ? 'fa-heart text-danger' : 'fa-heart-o'"></i> 좋아요
                </button>
            </div>
        </div>
    </div>

    <form th:action="@{/shop/order}" method="post">
        <input type="hidden" name="bookId" th:value="${book.bookId}">
        <input type="hidden" name="quantity" value="1">
        <button type="submit">주문하기</button>
    </form>


    <!-- 카테고리 및 태그 -->
    <div class="row mt-4">
        <div class="col-md-6">
            <h5 class="fs-6">카테고리</h5>
            <ul class="list-group list-group-flush small">
                <li class="list-group-item" th:each="categoryGroup : ${book.categoryList}">
                    <ul class="list-inline">
                        <li class="list-inline-item badge bg-secondary text-light me-1 mb-1"
                            th:each="category : ${categoryGroup}"
                            th:text="${category.categoryName}"></li>
                    </ul>
                </li>
            </ul>
        </div>

        <div class="col-md-6">
            <h5 class="fs-6">태그</h5>
            <ul class="list-inline small">
                <li class="list-inline-item badge bg-primary text-light" th:each="tag : ${book.tagList}"
                    th:text="${tag.tagName}"></li>
            </ul>
        </div>
    </div>

    <!-- 기여자 -->
    <div class="mt-4">
        <h5 class="fs-6">기여자</h5>
        <ul class="list-group list-group-flush small">
            <li class="list-group-item" th:each="contributor : ${book.contributorResponsDtos}">
                <strong th:text="${contributor.contributorName}">기여자 이름</strong> -
                <span th:text="${contributor.contributorRole}">역할</span>
            </li>
        </ul>
    </div>

    <!-- 추천 도서 -->
    <section class="mt-5">
        <h5 class="text-center fs-6 mb-4">같은 카테고리 도서 추천</h5>
        <div th:if="${#lists.isEmpty(recommendBooks)}" class="text-center">
            <p class="small">추천 도서가 없습니다.</p>
        </div>
        <div class="row" th:if="${!#lists.isEmpty(recommendBooks)}">
            <div class="col-md-3 mb-4" th:each="recommendBook : ${recommendBooks}">
                <div class="card h-100">
                    <!-- 이미지 -->
                    <img th:src="${recommendBook.imagePath}" class="card-img-top" alt="도서 이미지"
                         th:alt="'이미지 없음 - ' + ${recommendBook.title}"
                         style="width: 100%; height: 150px; object-fit: cover;">
                    <div class="card-body">
                        <!-- 제목 -->
                        <h6 class="card-title small" th:text="${recommendBook.title}"></h6>
                        <!-- 출판사 -->
                        <p class="card-text small" th:text="'출판사: ' + ${recommendBook.publisher}"></p>
                        <!-- 가격 -->
                        <p class="card-text small" th:text="'가격: ' + ${recommendBook.price} + '원'"></p>
                        <!-- 상세보기 -->
                        <a th:href="@{'/books/' + ${recommendBook.bookId}}" class="btn btn-outline-primary btn-sm">자세히
                            보기</a>
                    </div>
                </div>
            </div>
        </div>

    </section>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const likeButtons = document.querySelectorAll('.like-button');
        likeButtons.forEach(button => {
            button.addEventListener('click', () => {
                const bookId = button.getAttribute('data-book-id');
                const isLiked = button.getAttribute('data-is-liked') === 'true';

                fetch(`/likes`, {
                    method: 'PUT',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({bookId: bookId, userId: 1}) // Replace 1 with actual user ID
                })
                    .then(response => {
                        if (!response.ok) throw new Error('Failed to update like status');
                        return response.json();
                    })
                    .then(data => {
                        button.setAttribute('data-is-liked', data.isLiked);
                        const icon = button.querySelector('i');
                        if (data.isLiked) {
                            icon.classList.remove('fa-heart-o');
                            icon.classList.add('fa-heart', 'text-danger');
                        } else {
                            icon.classList.remove('fa-heart', 'text-danger');
                            icon.classList.add('fa-heart-o');
                        }
                    })
                    .catch(error => console.error(error));
            });
        });
    });
</script>




</body>
</html>
